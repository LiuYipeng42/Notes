# 内存分配策略

1. 大多数情况下，**对象在新生代中分配**。当新生代没有足够空间进行分配时，虚拟机将发起一次  Minor GC（针对新生代的垃圾回收）

2. 占用**大量连续内存空间的 Java对象直接进入老年代**

3. **长期存活的对象会进入老年区**。HotSpot虚拟机给每个对象定义了一个对象年龄计数器，存储在对象头中，对象在新生代每经过一次垃圾收集，若没有被回收，就会将年龄计数器加 1。当增加到一定程度时，就会进入老年代。

4. **动态 对象年龄判断**。若在新生代中，某一个年龄的所有对象的占用内存总和大于一定值，就会将大于或等于此年龄的对象直接放入老年代。

5. 在发生  Minor GC之前，虚拟机会先检查老年代最大可用的连续空间是否大于新生代所有对象的总和。若大于，则会进行 Minor GC，否则则会查看虚拟机的-XX:Handle

   ​		PromotionFailure 参数可以设置是否允许担保失败。若允许，则会检查老年代最大可用的连续空间是否大于历次晋升到老年代对象的平均大小，若大于，则会进行一次 Minor GC，否则则会进行 Full GC（针对新生代和老年代的垃圾回收）。但若进行的是 Minor GC，则会出现新生代进行回收后依旧有很多对象，老年代中的空间依旧放不下，此时就会担保失败，然后进行 Full GC。



